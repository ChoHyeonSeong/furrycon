pipeline{
    agent any
    stages {
        stage('Hello World'){
            steps{
                echo 'Hello World'
            }
        }
        stage('Git Clone'){
            steps{
                echo 'Clonning Repository'
                git branch: 'main', 
                url: 'git@github.com:ChoHyeonSeong/furrycon.git'
            }
            post {
                success { 
                    echo 'Successfully Cloned Repository'
                }
                failure {
                    error 'This pipeline stops here...'
                }
            }
        }
        stage('Frontend Build'){
            steps {
                echo 'Building Frontend'
                // Node.js 설치 (NodeJS 플러그인 필요)
                script {
                    def nodeHome = tool name: "NodeJS 20.x", type: 'NodeJSInstallation'
                    env.PATH = "${nodeHome}/bin:${env.PATH}"
                }
                dir('./furrycon'){
                    // 프로젝트 의존성 설치
                    sh 'npm install'

                    // 프로젝트 빌드
                    sh 'npm run build'
                }
            }
            post{
                success { 
                    echo 'Successfully Build Frontend'
                }
                failure{
                    error 'This pipeline stops here...'
                }
            }
        }
        stage('Backend Build'){
            steps{
                echo 'Building Backend'
                dir('./furrycon-server/furrycon'){
                    sh './gradlew clean build'
                }
            }
            post{
                success { 
                    echo 'Successfully Build Backend'
                }
                failure{
                    error 'This pipeline stops here...'
                }
            }
        }
        stage('Project Deploy'){
            steps{
                echo 'Deploying Project'
            }
        }
    }
}